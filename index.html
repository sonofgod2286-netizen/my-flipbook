<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <title>시민과 함께하는 올바른 자전거 이용하기</title>

  <style>
    body {
      margin: 0;
      background: #0f1720;
      display: flex;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
      color: #e5e7eb;
    }
    #wrapper {
      margin-top: 32px;
    }
    /* 책 컨테이너는 가운데 정렬만 */
    #flipbook {
      margin: 0 auto;
    }
    /* 페이지는 크기를 JS에서 조절함 */
    .page {
      background-size: cover;
      background-position: center;
      background-color: #ffffff;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .controls button {
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid #324355;
      background: #1f2933;
      color: #f9fafb;
      cursor: pointer;
    }
    .controls button:hover {
      background: #243447;
    }
    .page-indicator {
      font-variant-numeric: tabular-nums;
      font-size: 14px;
    }
  </style>

  <!-- jQuery 먼저 로드 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- 그다음 Turn.js 3.x -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
</head>
<body>

<div id="wrapper">
  <div class="controls">
    <button id="prevBtn">◀ 이전</button>
    <span class="page-indicator" id="pageIndicator">1 / 36</span>
    <button id="nextBtn">다음 ▶</button>
  </div>
  <div id="flipbook"></div>
</div>

<script>
  const totalPages = 36;  // 36페이지

  function loadPages() {
    const fb = document.getElementById('flipbook');
    for (let i = 1; i <= totalPages; i++) {
      const page = document.createElement('div');
      page.className = 'page';
      page.style.backgroundImage = `url('./pages/${i}.jpg')`;
      fb.appendChild(page);
    }
  }

  // 화면 크기에 맞춰 책/페이지 사이즈 계산
  function getBookSize() {
    const vw = window.innerWidth || document.documentElement.clientWidth;

    // 기본 페이지 너비
    let pageWidth = 480;

    if (vw <= 480) {
      pageWidth = vw * 0.42;   // 아주 작은 모바일
    } else if (vw <= 768) {
      pageWidth = vw * 0.38;   // 일반 모바일
    } else if (vw <= 1024) {
      pageWidth = vw * 0.32;   // 태블릿
    }

    const pageHeight = pageWidth * 4 / 3;  // 3:4 비율
    const bookWidth = pageWidth * 2;
    const bookHeight = pageHeight;

    return { bookWidth, bookHeight, pageWidth, pageHeight };
  }

  function applySize() {
    const s = getBookSize();
    $('#flipbook').turn('size', s.bookWidth, s.bookHeight);
    $('.page').css({
      width: s.pageWidth + 'px',
      height: s.pageHeight + 'px'
    });
  }

  function updateIndicator(current) {
    const indicator = document.getElementById('pageIndicator');
    indicator.textContent = current + ' / ' + totalPages;
  }

  $(function () {
    loadPages();

    const s = getBookSize();

    $('#flipbook').turn({
      width: s.bookWidth,
      height: s.bookHeight,
      autoCenter: true,
      elevation: 50,
      gradients: true,
      when: {
        turned: function (e, page) {
          updateIndicator(page);
        }
      }
    });

    $('.page').css({
      width: s.pageWidth + 'px',
      height: s.pageHeight + 'px'
    });

    // 초기 페이지 인디케이터
    updateIndicator(1);

    $('#prevBtn').on('click', function () {
      $('#flipbook').turn('previous');
    });
    $('#nextBtn').on('click', function () {
      $('#flipbook').turn('next');
    });

    // 키보드 ← → 로 페이지 넘기기
    $(document).on('keydown', function (e) {
      if (e.key === 'ArrowLeft') $('#flipbook').turn('previous');
      if (e.key === 'ArrowRight') $('#flipbook').turn('next');
    });

    // 화면 회전/크기 변경 시 자동 리사이즈
    $(window).on('resize', function () {
      applySize();
    });
  });
</script>

</body>
</html>
